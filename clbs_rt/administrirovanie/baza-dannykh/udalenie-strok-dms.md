---
title: Удаление DMS (план)
description: 
published: true
date: 2022-08-29T09:02:42.934Z
tags: 
editor: markdown
dateCreated: 2022-08-29T08:44:45.264Z
---

# Удаление строк DMS

**Роботы, отвечающие за удаления** [\_DMS\_DEL\_](../planirovshik-zadach/\_dms\_del\_.md)

Важно включение выключение роботов происходит в т.ч. через таблицу \_DMS\_DP

Update \_DMS\_DP Set Stop =0 – Чтобы включенные роботы начали работать

Update \_DMS\_DP Set Stop =1 – Чтобы роботы, в т.ч. выключенные начали выключиться – тушаться они несколько минут

В этой же таблице дата до которой чистить DT\_DEL

![](<../../assets/0 (35).png>)

После текущей очистки необходимо

**Обновить DT\_DEL на месяц или 2 – действуем в несколько приходов, пока даты 01-01-2022, дальше у Лисицына уточнять**

**После каждой итерации очищаем** \_DMS\_L\_ от оставшегося мусора (это сессии оборванные сбойно)

truncate table \_DMS\_L\_

Выставляем дату в \_DMS\_DP

Заполняем очередь RRT \_QUEFORDEL

> НИГДЕ НИКАКИХ ЗАЩИТ ОТ НЕПРАВИЛЬНЫХ ДЕЙСТВИЙ НЕТУ, ЭТО “ВОССТАНОВЛЕННЫЙ” АЛГОРИТМ ПРИМАКА, ДЕЛАТЬ ВНИМАТЬТЕЛЬНО И АККУРАТНО
{.is-info}

В Планировщике есть RRT Заполнить (\_QUEFORDEL) очередь на удаление – доступ заполнить самостоятельно

\- собственно заполняет \_DMS\_L\_ в соответствии с настройками \_DMS\_DP

![](<../../assets/1 (45)>)

Сколько еще обрабатывать

Select count(\*) from \_DMS\_L\_ where SESSIONID is NULL – с помощью этого инструмента

* При не корректных завершениях там может мусор оставаться

Select count(\*) from DMS where KDMT in ('\_SHORTAGE','PR\_M334C') and DATE\_D< '20210830'

\- реально (запрос выполняется долго, минуты 2)
